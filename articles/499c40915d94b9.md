---
title: "ã€Nexy.jsã€‘å€‹äººçš„ãŠæ°—ã«å…¥ã‚Šã®ç’°å¢ƒæ§‹ç¯‰"
emoji: "ğŸŒŠ"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: [nextjs]
published: false
---
Next.jsãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã§é–‹ç™ºã™ã‚‹ã«å½“ãŸã‚Šã€å€‹äººçš„ãŠæ°—ã«å…¥ã‚Šã®ç’°å¢ƒæ§‹ç¯‰æ–¹æ³•ã‚’ã¾ã¨ã‚ã¾ã™ã€‚
<!-- TypeScript, ESLint, Prettier, Huskyãªã©ã‚’å°å…¥ã™ã‚‹æ‰‹é †ã‚’ã¾ã¨ã‚ã¾ã™ã€‚ -->

## Next.jsã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«

å…¬å¼ãƒšãƒ¼ã‚¸ã®é€šã‚Šã«Next.jsã‚’ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ã—ã¾ã™ã€‚

```bash
npx create-next-app@latest
```

å¯¾è©±å½¢å¼ã§è³ªå•ã•ã‚Œã‚‹ã®ã§ã€ä»¥ä¸‹ã®ã‚ˆã†ã«å›ç­”ã—ã¾ã™ã€‚

```bash
? What is your project named? â€º my-app
# ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆåã‚’å…¥åŠ›

? Would you like to use TypeScript? â€º No / Yes
# Yes ã‚’é¸æŠ

? Would you like to use ESLint? â€º No / Yes
# Yes ã‚’é¸æŠ

? Would you like to use Tailwind CSS? â€º No / Yes
# å¥½ã¿ã§é¸æŠï¼ˆå€‹äººçš„ã«ã¯ No ã‚’é¸æŠã—ã¦ã„ã‚‹ï¼‰

? Would you like to use `src/` directory? â€º No / Yes
# å¥½ã¿ã§é¸æŠï¼ˆå€‹äººçš„ã«ã¯ Yes ã«ã—ã¦ã„ã‚‹ï¼‰

? Would you like to use App Router? (recommended) â€¦ No / Yes
# Yes ã‚’é¸æŠ

? Would you like to customize the default import alias (@/*)? â€¦ No / Yes
# No ã‚’é¸æŠ
```

ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ãŒå®Œäº†ã™ã‚‹ã¨ã€ä»¥ä¸‹ã®ã‚ˆã†ãªãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹æˆã§ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãŒä½œæˆã•ã‚Œã¦ã„ã‚‹ã¯ãšã§ã™ã€‚

```bash
.
â”œâ”€â”€ public
â”œâ”€â”€ src
â”‚   â””â”€â”€ app
â”‚       â”œâ”€â”€ favicon.ico
â”‚       â”œâ”€â”€ globals.css
â”‚       â”œâ”€â”€ layout.tsx
â”‚       â”œâ”€â”€ page.module.cs
â”‚       â””â”€â”€ page.tsx
â”œâ”€â”€ .gitignore
â”œâ”€â”€ eslint.config.mjs
â”œâ”€â”€ next-env.d.ts
â”œâ”€â”€ next.config.js
â”œâ”€â”€ package-lock.json
â”œâ”€â”€ package.json
â”œâ”€â”€ README.md
â””â”€â”€ tsconfig.json
```

ãƒ­ãƒ¼ã‚«ãƒ«ã‚µãƒ¼ãƒã‚’èµ·å‹•ã•ã›ã€å•é¡Œãªã‘ã‚Œã°ã“ã“ã§ä¸€åº¦ãƒªãƒ¢ãƒ¼ãƒˆã«`git push`ã—ã¦ãŠãã¾ã™ã€‚

```bash
npm run dev
```

## Prettierã®è¨­å®š

ã‚³ãƒ¼ãƒ‰ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã‚’è¡Œã†ãŸã‚ã«ã€Prettierã¨é–¢é€£ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¾ã™ã€‚

```bash
npm i -D prettier prettier-plugin-organize-imports
```

`prettier-plugin-organize-imports`ã¯importæ–‡ã‚’ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã—ã¦ãã‚Œã‚‹ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã§ã€ä¸»ã«ä»¥ä¸‹ã®3ã¤ã®ã“ã¨ã‚’ã—ã¦ãã‚Œã¾ã™ã€‚

- importæ–‡ã‚’ã‚¢ãƒ«ãƒ•ã‚¡ãƒ™ãƒƒãƒˆé †ã§ä¸¦ã³æ›¿ãˆ
- å†—é•·ã«æ›¸ã‹ã‚ŒãŸimportæ–‡ã‚’çµ±åˆ
- importã•ã‚ŒãŸã‚‚ã®ã®æœªä½¿ç”¨ãªã‚‚ã®ã®å‰Šé™¤

https://www.npmjs.com/package/prettier-plugin-organize-imports

rootãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«ä»¥ä¸‹ã®å†…å®¹ã§Prettierã®è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆã—ã¾ã™ã€‚

```json:.prettier
{
  "trailingComma": "all",
  "tabWidth": 2,
  "useTabs": false,
  "semi": false,
  "singleQuote": true,
  "jsxSingleQuote": false,
  "arrowParens": "always",
  "printWidth": 100,
  "bracketSpacing": true,
  "plugins": ["prettier-plugin-organize-imports"],
  "overrides": [
    {
      "files": "*.html",
      "options": {
        "printWidth": 360
      }
    },
    {
      "files": ["*.css", "*.scss"],
      "options": {
        "singleQuote": false
      }
    }
  ]
}
```

ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã®å¯¾è±¡å¤–ã‚’å®šç¾©ã—ãŸãƒ•ã‚¡ã‚¤ãƒ«ã‚‚rootãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªä¸Šã«ä½œæˆã—ã¾ã™ã€‚

```json:.prettierignore
node_modules/
.next/
build/
dist/
out/
public/
package-lock.json
yarn.lock
pnpm-lock.yaml
next.config.js
```

æœ¬è³ªçš„ã«ãƒªãƒ³ãƒˆã‚„ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆãŒé‡è¦ã§ãªã„ãƒ•ã‚¡ã‚¤ãƒ«ã¯ã€ã“ã“ã§é™¤å¤–ã—ã¦ã„ã¾ã™ã€‚

## ESLintã®è¨­å®š

ESLintã§ã¯ä¸‹è¨˜ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚’è¿½åŠ ã§ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¾ã™ã€‚

```bash
npm i -D @typescript-eslint/parser @typescript-eslint/eslint-plugin eslint-config-prettier
```

- [@typescript-eslint/eslint-plugin](https://typescript-eslint.io/getting-started/)
  - TypeScriptã®æ¨å¥¨ãƒ«ãƒ¼ãƒ«ã‚’æä¾›ã™ã‚‹ãƒ—ãƒ©ã‚°ã‚¤ãƒ³
- [@typescript-eslint/parser](https://typescript-eslint.io/getting-started/)
  - TypeScriptã‚’è§£æã™ã‚‹ãŸã‚ã®ãƒ‘ãƒ¼ã‚µ
- [eslint-config-prettier](https://github.com/prettier/eslint-config-prettier)
  - Prettierã¨ESLintã‚’ä½µç”¨ã™ã‚‹ãŸã‚ã®ç«¶åˆãƒ«ãƒ¼ãƒ«ã‚’è§£æ¶ˆã™ã‚‹å…±æœ‰è¨­å®š

rootãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªä¸Šã«ä»¥ä¸‹ã®å†…å®¹ã§ESLintã®è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆã—ã¾ã™ã€‚
â€»eslint v9ç³»ä»¥é™ã§ã¯è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã®æ›¸ãæ–¹ãŒå¤‰ã‚ã£ã¦ã„ã‚‹ãŸã‚æ³¨æ„

```json:eslintrc.json
{
  "extends": [
    "next/core-web-vitals",
    "plugin:@typescript-eslint/recommended",
    "prettier"
  ],
  "parser": "@typescript-eslint/parser",
  "plugins": ["@typescript-eslint"],
  "rules": {
    "@typescript-eslint/consistent-type-imports": [
      "error",
      {
        "prefer": "type-imports",
        "fixStyle": "separate-type-imports"
      }
    ],
    "@typescript-eslint/no-unused-vars": [
      "warn",
      {
        "vars": "all",
        "varsIgnorePattern": "^_",
        "args": "after-used",
        "argsIgnorePattern": "^_"
      }
    ],
    "object-shorthand": "error",
    "react/jsx-curly-brace-presence": "error",
    "react/self-closing-comp": [
      "error",
      {
        "component": true,
        "html": false
      }
    ],
    "@next/next/no-img-element": "off"
  },
  "ignorePatterns": [
    "node_modules/",
    ".next/",
    "build/",
    "dist/",
    "out/",
    "public/",
    "package-lock.json",
    "next.config.js",
    "tsconfig.json",
    "src/env.d.ts",
    "*.cjs",
    "*.mjs"
  ]
}
```

## VS Codeã®è¨­å®š

ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä¿å­˜æ™‚èˆŒã‚¿ã‚¤ãƒŸãƒ³ã‚°ã§Prettierã«ã‚ˆã‚‹ã‚³ãƒ¼ãƒ‰ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆãŒè¡Œã‚ã‚Œã‚‹ã‚ˆã†ã«ã€æ¬¡ã®å†…å®¹ã§`.vscode/settings.json`ã‚’rootãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªä¸Šã«ä½œæˆã—ã¾ã™ã€‚

```json:.vscode/settings.json
{
  "editor.defaultFormatter": "esbenp.prettier-vscode",
  "editor.formatOnSave": false,
  "editor.formatOnPaste": true,
  "editor.codeActionsOnSave": {
    "source.addMissingImports": "explicit",
    "source.fixAll.eslint": "explicit"
  },
  "javascript.preferences.importModuleSpecifier": "non-relative",
  "typescript.preferences.importModuleSpecifier": "non-relative",
  "eslint.validate": [
    "html",
    "javascript",
    "javascriptreact",
    "typescript",
    "typescriptreact"
  ]
}
```

## npmã‚³ãƒãƒ³ãƒ‰ã®è¨­å®š

`npm-run-all`ã¨ã„ã†ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚’ä½¿ç”¨ã—ã¦ã€npmã‚³ãƒãƒ³ãƒ‰ã‚’è¿½åŠ ã—ã¾ã™ã€‚

```bash
npm i -D npm-run-all
```

```diff json: package.json
{
 "scripts": {
   "dev": "next dev",
   "build": "next build",
   "start": "next start",
-  "lint": "next lint"
+  "lint": "run-p -l -c --aggregate-output lint:*",
+  "lint:eslint": "eslint .",
+  "lint:prettier": "prettier --check .",
+  "fix": "run-s fix:prettier fix:eslint",
+  "fix:eslint": "npm run lint:eslint -- --fix",
+  "fix:prettier": "npm run lint:prettier -- --write",
  },
}
```

## Huskyã®è¨­å®š

ã“ã“ã¾ã§ã®è¨­å®šã§ã€ã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ä¸­ã«è‡ªå‹•ã§ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆãŒè¡Œã‚ã‚Œã‚‹ã‚ˆã†ã«ãªã£ã¦ã„ã¾ã™ãŒã€Huskyã¨lint-stagedã‚’å°å…¥ã—ã€ã‚³ãƒŸãƒƒãƒˆå‰ã«ã‚‚è‡ªå‹•ã§ESLintã¨PrettierãŒå®Ÿè¡Œã•ã‚Œã‚‹ã‚ˆã†ã«ã—ã¾ã™ã€‚

```bash
npm i -D husky lint-staged
```

ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã§ããŸã‚‰ã€ä¸‹è¨˜ã‚³ãƒãƒ³ãƒ‰ã§Huskyã«ã‚ˆã‚‹Gitãƒ•ãƒƒã‚¯ã‚’æœ‰åŠ¹åŒ–ã—ã¾ã™ã€‚
ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã™ã‚‹ã¨`.husky`ã¨ã„ã†ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªãŒä½œæˆã•ã‚Œã¾ã™ã€‚

```bash
npx husky install
```

æ¬¡ã«ä»–ã®é–‹ç™ºè€…ãŒ`npm i`ãªã©ã§ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ãŸéš›ã«ã€è‡ªå‹•çš„ã«Huskyã‚’åˆ©ç”¨ã™ã‚‹æº–å‚™ãŒè¡Œã‚ã‚Œã‚‹ã‚ˆã†ã€`package.json`ã«`prepare`ã‚³ãƒãƒ³ãƒ‰ã‚’è¿½åŠ ã—ã¾ã™ã€‚

```bash
npm pkg set scripts.prepare="husky install"
```

`.husky/pre-commit`ãƒ•ã‚¡ã‚¤ãƒ«ã®ä¸­èº«ã‚’ä¸‹è¨˜ã®å†…å®¹ã§æ›¸ãæ›ãˆã¾ã™ã€‚

```txt
npx lint-staged
```

`package.json`ã«lint-stagedã§è¡Œã†å‡¦ç†ã‚’è¿½åŠ ã—ã¾ã™ã€‚

```diff json:package.json
{
  ...{},
+ "lint-staged": {
+   "src/**/*.{js,jsx,ts,tsx}": [
+     "eslint --fix",
+     "prettier --write"
+   ]
+ }
}
```

ã“ãˆã§`git commit`ã‚’è¡Œã†ã¨ã€`pre-commit`ã®ã‚¿ã‚¤ãƒŸãƒ³ã‚°ã§ã‚¹ãƒ†ãƒ¼ã‚¸ãƒ³ã‚°ã•ã‚ŒãŸãƒ•ã‚¡ã‚¤ãƒ«ã«å¿œã˜ã¦`package.json`ã®`lint-staged`ã«è¨˜è¿°ã—ãŸESLintã¨PrettierãŒå®Ÿè¡Œã•ã‚Œã¾ã™ã€‚

## GitHub Actionsã®è¨­å®š

PRã‚’ä½œæˆã—ãŸã‚¿ã‚¤ãƒŸãƒ³ã‚°ã§ç°¡æ˜“çš„ãªCIãŒèµ°ã‚‹ã‚ˆã†ã«GitHub Actionsã®è¨­å®šã‚’è¡Œã„ã¾ã™ã€‚

ä¸‹è¨˜ã®å†…å®¹ã§ymlãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆã—ã¾ã™ã€‚

```yml:build.yml

name: Build Test
on:
  pull_request:
    types:
      - opened
      - synchronize
      - reopened

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - name: checkout
        uses: actions/checkout@v4

      - name: setup node.js
        uses: actions/setup-node@v4
        with:
          node-version: 20
          cache: 'npm'

      - name: cache node_modules
        uses: actions/cache@v4
        id: node_modules_cache_id
        env:
          cache-name: cache-node_modules
        with:
          path: '**/node_modules'
          key: ${{ runner.os }}-build-${{ env.cache-name }}-${{ hashFiles('**/package-lock.json') }}

      - name: install dependencies
        if: ${{ steps.node_modules_cache_id.outputs.cache-hit != 'true' }}
        run: npm i

      - name: Run Lint
        run: npm run lint

      - name: Build
        run: npm run build
```

æ¬¡ã«PRã«è‡ªåˆ†è‡ªèº«ã‚’ã‚¢ã‚µã‚¤ãƒ³ã™ã‚‹ãŸã‚ã®ymlãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆã—ã¾ã™ã€‚

```yml: assign_author.yml
on:
  pull_request:
    types: [opened]
name: Assign author to PR
jobs:
  assignAuthor:
    name: Assign author to PR
    permissions:
      issues: write
      pull-requests: write
    runs-on: ubuntu-latest
    steps:
      - name: Assign author to PR
        uses: technote-space/assign-author@v1
```

ã“ã‚Œã§GitHubã§PRã‚’ä½œæˆã—ãŸã¨ãã«ã€è‡ªå‹•ã§buildãƒ†ã‚¹ãƒˆã¨PRã«è‡ªåˆ†è‡ªèº«ãŒã‚¢ã‚µã‚¤ãƒ³ã•ã‚Œã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚

## å‚è€ƒã«ã—ãŸè¨˜äº‹

https://zenn.dev/siakas/articles/05481bdefacd13
